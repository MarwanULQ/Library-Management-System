import unittest
from services.auth_services import signup, login
from services.database.db import get_db, init_db
import os
class TestAuthService(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        init_db() [cite: 18, 1003]
    def test_1_signup_success(self):
        user_id = signup("newuser@example.com", "password123") [cite: 8, 1013]
        self.assertIsInstance(user_id, str)
        self.assertGreater(len(user_id), 0)
    def test_2_signup_duplicate_email(self):
        """اختبار منع التسجيل بنفس الإيميل"""
        # الإيميل ده تم تسجيله في الخطوة اللي فاتت
        with self.assertRaises(ValueError) as context:
            signup("newuser@example.com", "anypassword") [cite: 9, 1013]
        self.assertEqual(str(context.exception), "Email already exists") [cite: 9, 1013]
    def test_3_login_success(self):
        user_id = login("newuser@example.com", "password123") [cite: 12, 1015]
        self.assertIsInstance(user_id, str)
    def test_4_login_wrong_password(self):
        with self.assertRaises(ValueError) as context:
            login("newuser@example.com", "wrong_pass") [cite: 13, 1015]
        self.assertEqual(str(context.exception), "Invalid credentials") [cite: 13, 1015]
if __name__ == '__main__':
    unittest.main()
